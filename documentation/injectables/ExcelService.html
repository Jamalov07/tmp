<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>tmp documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">tmp documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >ExcelService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/shared/excel/excel.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#prisma" >prisma</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#allBorder" >allBorder</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#arrivalDownloadMany" >arrivalDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#arrivalDownloadOne" >arrivalDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#clientDeedDownloadOne" >clientDeedDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#clientDeedWithProductDownloadOne" >clientDeedWithProductDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#clientDownloadMany" >clientDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#clientPaymentDownloadMany" >clientPaymentDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#formatDate" >formatDate</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#returningDownloadMany" >returningDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#returningDownloadOne" >returningDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sellingDownloadMany" >sellingDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sellingDownloadOne" >sellingDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#staffPaymentDownloadMany" >staffPaymentDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#supplierDeedDownloadOne" >supplierDeedDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#supplierDeedWithProductDownloadOne" >supplierDeedWithProductDownloadOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#supplierDownloadMany" >supplierDownloadMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#supplierPaymentDownloadMany" >supplierPaymentDownloadMany</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(prisma: <a href="../injectables/PrismaService.html" target="_self">PrismaService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="18" class="link-to-prism">src/modules/shared/excel/excel.service.ts:18</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>prisma</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PrismaService.html" target="_self" >PrismaService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="allBorder"></a>
                    <span class="name">
                        <span ><b>allBorder</b></span>
                        <a href="#allBorder"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>allBorder()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1981"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1981</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Partial&lt;ExcelJS.Borders&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="arrivalDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>arrivalDownloadMany</b></span>
                        <a href="#arrivalDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>arrivalDownloadMany(res: Response, query: <a href="../interfaces/ArrivalFindManyRequest.html" target="_self">ArrivalFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="243"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:243</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ArrivalFindManyRequest.html" target="_self" >ArrivalFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="arrivalDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>arrivalDownloadOne</b></span>
                        <a href="#arrivalDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>arrivalDownloadOne(res: Response, query: <a href="../interfaces/ArrivalFindOneRequest.html" target="_self">ArrivalFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="349"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:349</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ArrivalFindOneRequest.html" target="_self" >ArrivalFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clientDeedDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>clientDeedDownloadOne</b></span>
                        <a href="#clientDeedDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clientDeedDownloadOne(res: Response, query: <a href="../interfaces/ClientFindOneRequest.html" target="_self">ClientFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="860"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:860</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientFindOneRequest.html" target="_self" >ClientFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clientDeedWithProductDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>clientDeedWithProductDownloadOne</b></span>
                        <a href="#clientDeedWithProductDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clientDeedWithProductDownloadOne(res: Response, query: <a href="../interfaces/ClientFindOneRequest.html" target="_self">ClientFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1066"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1066</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientFindOneRequest.html" target="_self" >ClientFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clientDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>clientDownloadMany</b></span>
                        <a href="#clientDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clientDownloadMany(res: Response, query: <a href="../interfaces/ClientFindManyRequest.html" target="_self">ClientFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1671"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1671</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientFindManyRequest.html" target="_self" >ClientFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clientPaymentDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>clientPaymentDownloadMany</b></span>
                        <a href="#clientPaymentDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clientPaymentDownloadMany(res: Response, query: <a href="../interfaces/ClientPaymentFindManyRequest.html" target="_self">ClientPaymentFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="668"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:668</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientPaymentFindManyRequest.html" target="_self" >ClientPaymentFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formatDate"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>formatDate</b></span>
                        <a href="#formatDate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>formatDate(date: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank">Date</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1970"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1970</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>date</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="returningDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>returningDownloadMany</b></span>
                        <a href="#returningDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>returningDownloadMany(res: Response, query: <a href="../interfaces/ReturningFindManyRequest.html" target="_self">ReturningFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="446"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:446</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ReturningFindManyRequest.html" target="_self" >ReturningFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="returningDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>returningDownloadOne</b></span>
                        <a href="#returningDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>returningDownloadOne(res: Response, query: <a href="../interfaces/ReturningFindOneRequest.html" target="_self">ReturningFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="552"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:552</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ReturningFindOneRequest.html" target="_self" >ReturningFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sellingDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>sellingDownloadMany</b></span>
                        <a href="#sellingDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sellingDownloadMany(res: Response, query: <a href="../interfaces/SellingFindManyRequest.html" target="_self">SellingFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="24"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:24</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/SellingFindManyRequest.html" target="_self" >SellingFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sellingDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>sellingDownloadOne</b></span>
                        <a href="#sellingDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sellingDownloadOne(res: Response, query: <a href="../interfaces/SellingFindOneRequest.html" target="_self">SellingFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="121"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:121</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/SellingFindOneRequest.html" target="_self" >SellingFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="staffPaymentDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>staffPaymentDownloadMany</b></span>
                        <a href="#staffPaymentDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>staffPaymentDownloadMany(res: Response, query: <a href="../interfaces/StaffPaymentFindManyRequest.html" target="_self">StaffPaymentFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1898"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1898</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/StaffPaymentFindManyRequest.html" target="_self" >StaffPaymentFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supplierDeedDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>supplierDeedDownloadOne</b></span>
                        <a href="#supplierDeedDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>supplierDeedDownloadOne(res: Response, query: <a href="../interfaces/ClientFindOneRequest.html" target="_self">ClientFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1267"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1267</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientFindOneRequest.html" target="_self" >ClientFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supplierDeedWithProductDownloadOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>supplierDeedWithProductDownloadOne</b></span>
                        <a href="#supplierDeedWithProductDownloadOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>supplierDeedWithProductDownloadOne(res: Response, query: <a href="../interfaces/ClientFindOneRequest.html" target="_self">ClientFindOneRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1438"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1438</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientFindOneRequest.html" target="_self" >ClientFindOneRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supplierDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>supplierDownloadMany</b></span>
                        <a href="#supplierDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>supplierDownloadMany(res: Response, query: <a href="../interfaces/ClientFindManyRequest.html" target="_self">ClientFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1781"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:1781</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientFindManyRequest.html" target="_self" >ClientFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supplierPaymentDownloadMany"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>supplierPaymentDownloadMany</b></span>
                        <a href="#supplierPaymentDownloadMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>supplierPaymentDownloadMany(res: Response, query: <a href="../interfaces/ClientPaymentFindManyRequest.html" target="_self">ClientPaymentFindManyRequest</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="771"
                                    class="link-to-prism">src/modules/shared/excel/excel.service.ts:771</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>query</td>
                                            <td>
                                                            <code><a href="../interfaces/ClientPaymentFindManyRequest.html" target="_self" >ClientPaymentFindManyRequest</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="prisma"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>prisma</b></span>
                        <a href="#prisma"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../injectables/PrismaService.html" target="_self" >PrismaService</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="18" class="link-to-prism">src/modules/shared/excel/excel.service.ts:18</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { BadRequestException, Injectable } from &#x27;@nestjs/common&#x27;
import { PrismaService } from &#x27;../prisma&#x27;
import * as ExcelJS from &#x27;exceljs&#x27;
import { Response } from &#x27;express&#x27;
import * as fs from &#x27;fs&#x27;
import * as path from &#x27;path&#x27;
import { SellingFindManyRequest, SellingFindOneRequest } from &#x27;../../selling&#x27;
import { ArrivalFindManyRequest, ArrivalFindOneRequest } from &#x27;../../arrival&#x27;
import { ReturningFindManyRequest, ReturningFindOneRequest } from &#x27;../../returning&#x27;
import { Decimal } from &#x27;@prisma/client/runtime/library&#x27;
import { ClientPaymentFindManyRequest } from &#x27;../../client-payment&#x27;
import { SellingStatusEnum, ServiceTypeEnum, UserTypeEnum } from &#x27;@prisma/client&#x27;
import { ClientDeed, ClientFindManyRequest, ClientFindOneRequest } from &#x27;../../client&#x27;
import { DebtTypeEnum } from &#x27;../../../common&#x27;
import { StaffPaymentFindManyRequest } from &#x27;../../staff-payment&#x27;
@Injectable()
export class ExcelService {
	private readonly prisma: PrismaService

	constructor(prisma: PrismaService) {
		this.prisma &#x3D; prisma
	}

	async sellingDownloadMany(res: Response, query: SellingFindManyRequest) {
		const startDate &#x3D; query.startDate ? new Date(new Date(query.startDate).setHours(0, 0, 0, 0)) : undefined
		const endDate &#x3D; query.endDate ? new Date(new Date(query.endDate).setHours(23, 59, 59, 999)) : undefined

		const sellingList &#x3D; await this.prisma.sellingModel.findMany({
			where: {
				deletedAt: null,
				status: SellingStatusEnum.accepted,
				date: { ...(startDate &amp;&amp; { gte: startDate }), ...(endDate &amp;&amp; { lte: endDate }) },
			},
			include: {
				client: true,
				staff: true,
				products: { include: { product: true } },
				payment: true,
			},
			orderBy: { date: &#x27;desc&#x27; },
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Sotuvlar&#x27;)

		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;client&#x27;, width: 35 },
			{ key: &#x27;phone&#x27;, width: 20 },
			{ key: &#x27;summa&#x27;, width: 15 },
			{ key: &#x27;staff&#x27;, width: 25 },
			{ key: &#x27;info&#x27;, width: 40 },
			{ key: &#x27;debt&#x27;, width: 15 },
			{ key: &#x27;date&#x27;, width: 30 },
		]

		let total &#x3D; 0
		worksheet.insertRow(1, [&#x60;Общая сумма: 0&#x60;])
		worksheet.mergeCells(&#x27;A1:H1&#x27;)
		const cellA1 &#x3D; worksheet.getCell(&#x27;A1&#x27;)
		cellA1.font &#x3D; { bold: true }
		cellA1.border &#x3D; {
			top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
		}
		worksheet.insertRow(2, [])

		const headers &#x3D; [&#x27;№&#x27;, &#x27;Клиент&#x27;, &#x27;Тел&#x27;, &#x27;Сумма&#x27;, &#x27;Продавец&#x27;, &#x27;Информация&#x27;, &#x27;Долг&#x27;, &#x27;Дата продажи&#x27;]
		worksheet.insertRow(3, headers)
		worksheet.getRow(3).eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		})

		sellingList.forEach((item, index) &#x3D;&gt; {
			const totalSum &#x3D; item.products.reduce((sum, p) &#x3D;&gt; sum + p.price.toNumber() * p.count, 0)
			const paidSum &#x3D;
				(item.payment?.cash?.toNumber() ?? 0) + (item.payment?.card?.toNumber() ?? 0) + (item.payment?.transfer?.toNumber() ?? 0) + (item.payment?.other?.toNumber() ?? 0)

			const debt &#x3D; totalSum - paidSum
			total +&#x3D; totalSum

			const row &#x3D; worksheet.addRow({
				no: index + 1,
				client: item.client.fullname,
				phone: item.client.phone,
				summa: totalSum,
				staff: item.staff.fullname,
				info: item.payment?.description || &#x27;&#x27;,
				debt: debt,
				date: item.date.toLocaleString(&#x27;ru-RU&#x27;),
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				}
			})
		})

		cellA1.value &#x3D; &#x60;Общая сумма: ${total}&#x60;

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;selling-report.xlsx&quot;&#x27;)
		await workbook.xlsx.write(res)
		res.end()
	}

	async sellingDownloadOne(res: Response, query: SellingFindOneRequest) {
		const selling &#x3D; await this.prisma.sellingModel.findUnique({
			where: { id: query.id },
			include: {
				client: true,
				products: { include: { product: true } },
				payment: true,
			},
		})

		if (!selling) {
			res.status(404).send(&#x27;Sotuv topilmadi&#x27;)
			return
		}

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Chek&#x27;)

		// A1: Xaridor
		worksheet.mergeCells(&#x27;A1:B1&#x27;)
		const cellA1 &#x3D; worksheet.getCell(&#x27;A1&#x27;)
		cellA1.value &#x3D; &#x60;Xaridor: ${selling.client.fullname}&#x60;
		cellA1.font &#x3D; { bold: true }
		cellA1.border &#x3D; {
			top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
		}

		// D1: Telefon
		worksheet.mergeCells(&#x27;D1:E1&#x27;)
		const cellD1 &#x3D; worksheet.getCell(&#x27;D1&#x27;)
		cellD1.value &#x3D; &#x60;Telefon: ${selling.client.phone}&#x60;
		cellD1.font &#x3D; { bold: true }
		cellD1.border &#x3D; {
			top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
		}

		// 2-qator: Sarlavhalar
		const headerRow &#x3D; worksheet.addRow([&#x27;№&#x27;, &#x27;Махсулот номи&#x27;, &#x27;√&#x27;, &#x27;Сони&#x27;, &#x27;Нархи&#x27;, &#x27;Суммаси&#x27;])
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		})

		// Mahsulotlar
		let totalSum &#x3D; 0
		selling.products.forEach((item, index) &#x3D;&gt; {
			const count &#x3D; item.count
			const price &#x3D; item.price.toNumber()
			const sum &#x3D; count * price
			totalSum +&#x3D; sum

			const row &#x3D; worksheet.addRow([index + 1, item.product.name, &#x27;&#x27;, count, price, sum])
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				}
			})
		})

		// Bo&#x27;sh qator
		worksheet.addRow([])

		// To‘lovlar
		const paidSum &#x3D;
			(selling.payment?.cash?.toNumber() ?? 0) +
			(selling.payment?.card?.toNumber() ?? 0) +
			(selling.payment?.transfer?.toNumber() ?? 0) +
			(selling.payment?.other?.toNumber() ?? 0) +
			(selling.payment?.fromBalance?.toNumber() ?? 0)

		const totalRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;Жами сумма:&#x27;, totalSum])
		const paidRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;Тўлов қилинди:&#x27;, paidSum])

		const totalAndPaid &#x3D; [totalRow, paidRow]

		totalAndPaid.forEach((row) &#x3D;&gt; {
			row.eachCell((cell) &#x3D;&gt; {
				cell.font &#x3D; { bold: true }
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				}
			})
		})

		// Ustun o‘lchamlari
		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;name&#x27;, width: 40 },
			{ key: &#x27;check&#x27;, width: 10 },
			{ key: &#x27;count&#x27;, width: 20 },
			{ key: &#x27;price&#x27;, width: 25 },
			{ key: &#x27;total&#x27;, width: 25 },
		]

		// Javob
		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x60;attachment; filename&#x3D;&quot;selling-${selling.id}.xlsx&quot;&#x60;)

		await workbook.xlsx.write(res)
		res.end()
	}

	async arrivalDownloadMany(res: Response, query: ArrivalFindManyRequest) {
		const startDate &#x3D; query.startDate ? new Date(new Date(query.startDate).setHours(0, 0, 0, 0)) : undefined
		const endDate &#x3D; query.endDate ? new Date(new Date(query.endDate).setHours(23, 59, 59, 999)) : undefined

		const arrivalList &#x3D; await this.prisma.arrivalModel.findMany({
			where: {
				deletedAt: null,
				createdAt: {
					...(startDate &amp;&amp; { gte: startDate }),
					...(endDate &amp;&amp; { lte: endDate }),
				},
			},
			include: {
				supplier: true,
				staff: true,
				products: {
					select: {
						price: true,
						count: true,
						cost: true,
					},
				},
				payment: true,
			},
			orderBy: { createdAt: &#x27;desc&#x27; },
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Приходы&#x27;)

		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;supplier&#x27;, width: 35 },
			{ key: &#x27;summa&#x27;, width: 15 },
			{ key: &#x27;staff&#x27;, width: 25 },
			{ key: &#x27;info&#x27;, width: 40 },
			{ key: &#x27;date&#x27;, width: 30 },
		]

		let total &#x3D; 0

		// 1-qator: Общая сумма
		worksheet.insertRow(1, [&#x60;Общая сумма: 0&#x60;])
		worksheet.mergeCells(&#x27;A1:F1&#x27;)
		const cellA1 &#x3D; worksheet.getCell(&#x27;A1&#x27;)
		cellA1.font &#x3D; { bold: true }
		cellA1.border &#x3D; {
			top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
		}

		// 2-qator: bo&#x27;sh
		worksheet.insertRow(2, [])

		// 3-qator: Header
		const headers &#x3D; [&#x27;№&#x27;, &#x27;Поставщик&#x27;, &#x27;Сумма&#x27;, &#x27;Кем оприходован&#x27;, &#x27;Информация&#x27;, &#x27;Дата прихода&#x27;]
		worksheet.insertRow(3, headers)
		worksheet.getRow(3).eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		})

		// Ma&#x27;lumotlar
		arrivalList.forEach((item, index) &#x3D;&gt; {
			const totalSum &#x3D; item.products.reduce((sum, p) &#x3D;&gt; sum + p.cost.toNumber() * p.count, 0)
			total +&#x3D; totalSum

			const row &#x3D; worksheet.addRow({
				no: index + 1,
				supplier: item.supplier.fullname,
				summa: totalSum,
				staff: item.staff.phone,
				info: item.payment?.description || &#x27;&#x27;,
				date: item.createdAt.toLocaleString(&#x27;ru-RU&#x27;),
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				}
			})
		})

		// Общая сумма ni yangilash
		cellA1.value &#x3D; &#x60;Общая сумма: ${total}&#x60;

		// Excelga yozish
		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;arrival-report.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()
	}

	async arrivalDownloadOne(res: Response, query: ArrivalFindOneRequest) {
		const arrival &#x3D; await this.prisma.arrivalModel.findUnique({
			where: { id: query.id, deletedAt: null },
			include: {
				supplier: true,
				staff: true,
				products: {
					select: {
						price: true,
						count: true,
						cost: true,
						product: { select: { name: true } },
					},
				},
				payment: true,
			},
		})

		if (!arrival) {
			return res.status(404).json({ message: &#x27;Arrival not found&#x27; })
		}

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Приходы&#x27;)

		// Ustun o&#x27;lchamlari
		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;product&#x27;, width: 35 },
			{ key: &#x27;quantity&#x27;, width: 15 },
			{ key: &#x27;price&#x27;, width: 15 },
			{ key: &#x27;cost&#x27;, width: 15 },
		]

		// 1-qator: Приход от
		const arrivalDateRow &#x3D; worksheet.addRow([&#x60;Приход от: ${arrival.createdAt.toLocaleString(&#x27;ru-RU&#x27;)}&#x60;])
		worksheet.mergeCells(&#x60;A${arrivalDateRow.number}:E${arrivalDateRow.number}&#x60;)
		arrivalDateRow.getCell(1).font &#x3D; { bold: true }
		arrivalDateRow.getCell(1).border &#x3D; borderAll()

		// 2-qator: Поставщик
		const supplierRow &#x3D; worksheet.addRow([&#x60;Поставщик: ${arrival.supplier.fullname}&#x60;])
		worksheet.mergeCells(&#x60;A${supplierRow.number}:E${supplierRow.number}&#x60;)
		supplierRow.getCell(1).font &#x3D; { bold: true }
		supplierRow.getCell(1).border &#x3D; borderAll()

		// 3-qator: bo&#x27;sh
		worksheet.addRow([])

		// 4-qator: Header
		const headerTitles &#x3D; [&#x27;№&#x27;, &#x27;Товар&#x27;, &#x27;Количество&#x27;, &#x27;Цена&#x27;, &#x27;Стоимость&#x27;]
		const headerRow &#x3D; worksheet.addRow(headerTitles)
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		// Mahsulotlar
		arrival.products.forEach((product, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow([index + 1, product.product.name, product.count, product.price.toNumber(), product.cost.toNumber() * product.count])
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		// Bo&#x27;sh qator
		worksheet.addRow([])

		// Итого qatori
		const totalCost &#x3D; arrival.products.reduce((sum, p) &#x3D;&gt; sum + p.cost.toNumber() * p.count, 0)
		const totalRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;Итого&#x27;, &#x27;&#x27;, &#x27;&#x27;, totalCost])
		totalRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		// Excel javobi
		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;arrival-report-one.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()

		// Border helper funksiyasi
		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async returningDownloadMany(res: Response, query: ReturningFindManyRequest) {
		const startDate &#x3D; query.startDate ? new Date(new Date(query.startDate).setHours(0, 0, 0, 0)) : undefined
		const endDate &#x3D; query.endDate ? new Date(new Date(query.endDate).setHours(23, 59, 59, 999)) : undefined

		const returningList &#x3D; await this.prisma.returningModel.findMany({
			where: {
				status: query.status,
				clientId: query.clientId,
				OR: [{ client: { fullname: { contains: query.search, mode: &#x27;insensitive&#x27; } } }, { client: { phone: { contains: query.search, mode: &#x27;insensitive&#x27; } } }],
				date: {
					...(startDate &amp;&amp; { gte: startDate }),
					...(endDate &amp;&amp; { lte: endDate }),
				},
			},
			select: {
				date: true,
				client: { select: { fullname: true, phone: true } },
				staff: { select: { phone: true } },
				payment: { select: { cash: true, fromBalance: true, description: true } },
			},
			orderBy: { date: &#x27;desc&#x27; },
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Возвраты&#x27;)

		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;client&#x27;, width: 45 },
			{ key: &#x27;cash&#x27;, width: 15 },
			{ key: &#x27;balance&#x27;, width: 15 },
			{ key: &#x27;staff&#x27;, width: 20 },
			{ key: &#x27;info&#x27;, width: 25 },
			{ key: &#x27;date&#x27;, width: 20 },
		]

		let total &#x3D; new Decimal(0)

		// 1-qator: Общая сумма (dynamic, keyin yangilanadi)
		worksheet.insertRow(1, [&#x60;Общая сумма: 0&#x60;])
		worksheet.mergeCells(&#x27;A1:F1&#x27;)
		const cellA1 &#x3D; worksheet.getCell(&#x27;A1&#x27;)
		cellA1.font &#x3D; { bold: true }
		cellA1.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;left&#x27; }
		cellA1.border &#x3D; {
			top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
		}

		// 2-qator: bo‘sh qator
		worksheet.insertRow(2, [])

		// 3-qator: sarlavhalar
		const headers &#x3D; [&#x27;№&#x27;, &#x27;Клиент&#x27;, &#x27;Наличные&#x27;, &#x27;Из баланса&#x27;, &#x27;Кем отправован&#x27;, &#x27;Информация&#x27;, &#x27;Дата прихода&#x27;]
		worksheet.insertRow(3, headers)

		worksheet.getRow(3).eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		})

		// Ma&#x27;lumotlarni to‘ldirish
		returningList.forEach((item, index) &#x3D;&gt; {
			const sum &#x3D; item.payment?.cash.plus(item.payment?.fromBalance ?? 0) ?? new Decimal(0)
			total &#x3D; total.plus(sum)

			const row &#x3D; worksheet.addRow({
				no: index + 1,
				client: &#x60;${item.client.fullname} - ${item.client.phone}&#x60;,
				cash: item.payment.cash.toFixed(2),
				balance: item.payment.fromBalance.toFixed(2),
				staff: item.staff?.phone || &#x27;&#x27;,
				info: item.payment?.description || &#x27;&#x27;,
				date: item.date.toLocaleString(&#x27;ru-RU&#x27;),
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				}
			})
		})

		// Общая сумма yangilash
		cellA1.value &#x3D; &#x60;Общая сумма: ${total.toFixed(2)}&#x60;

		// Excel response
		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;returnings-report.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()
	}

	async returningDownloadOne(res: Response, query: ReturningFindOneRequest) {
		const returning &#x3D; await this.prisma.returningModel.findUnique({
			where: { id: query.id },
			select: {
				date: true,
				client: { select: { fullname: true } },
				products: {
					select: {
						count: true,
						price: true,
						product: { select: { name: true } },
					},
					orderBy: { createdAt: &#x27;asc&#x27; },
				},
			},
		})

		if (!returning) {
			return res.status(404).json({ message: &#x27;Returning not found&#x27; })
		}

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Возврат&#x27;)

		// Ustun o‘lchamlari
		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;product&#x27;, width: 40 },
			{ key: &#x27;quantity&#x27;, width: 15 },
			{ key: &#x27;price&#x27;, width: 12 },
			{ key: &#x27;cost&#x27;, width: 15 },
		]

		// 1-qator: Приход от: ...
		const formattedDate &#x3D; formatDate(returning.date)
		const dateRow &#x3D; worksheet.addRow([&#x60;Приход от: ${formattedDate}&#x60;])
		worksheet.mergeCells(&#x60;A${dateRow.number}:E${dateRow.number}&#x60;)
		const dateCell &#x3D; dateRow.getCell(1)
		dateCell.font &#x3D; { bold: true }
		dateCell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;left&#x27; }
		dateCell.border &#x3D; borderAll()

		// 2-qator: Клиент: ...
		const clientRow &#x3D; worksheet.addRow([&#x60;Клиент: ${returning.client.fullname}&#x60;])
		worksheet.mergeCells(&#x60;A${clientRow.number}:E${clientRow.number}&#x60;)
		const clientCell &#x3D; clientRow.getCell(1)
		clientCell.font &#x3D; { bold: true }
		clientCell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;left&#x27; }
		clientCell.border &#x3D; borderAll()

		// 3-qator: bo‘sh
		worksheet.addRow([])

		// 4-qator: Header
		const headerTitles &#x3D; [&#x27;№&#x27;, &#x27;Товар&#x27;, &#x27;Количество&#x27;, &#x27;Цена&#x27;, &#x27;Стоимость&#x27;]
		const headerRow &#x3D; worksheet.addRow(headerTitles)
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		// Mahsulotlar
		let total &#x3D; 0

		returning.products.forEach((item, index) &#x3D;&gt; {
			const count &#x3D; item.count
			const price &#x3D; item.price
			const cost &#x3D; count * price.toNumber()
			total +&#x3D; cost

			const row &#x3D; worksheet.addRow([index + 1, item.product.name, count, price.toNumber(), cost])
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		// Bo‘sh qator
		worksheet.addRow([])

		// Итого
		const totalRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;Итого&#x27;, &#x27;&#x27;, &#x27;&#x27;, total])
		totalRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		// Response
		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;returning-report.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()

		// Helpers
		function formatDate(date: Date): string {
			const dd &#x3D; String(date.getDate()).padStart(2, &#x27;0&#x27;)
			const mm &#x3D; String(date.getMonth() + 1).padStart(2, &#x27;0&#x27;)
			const yyyy &#x3D; date.getFullYear()
			const hh &#x3D; String(date.getHours()).padStart(2, &#x27;0&#x27;)
			const min &#x3D; String(date.getMinutes()).padStart(2, &#x27;0&#x27;)
			return &#x60;${dd}.${mm}.${yyyy} ${hh}:${min}&#x60;
		}

		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async clientPaymentDownloadMany(res: Response, query: ClientPaymentFindManyRequest) {
		const startDate &#x3D; query.startDate ? new Date(new Date(query.startDate).setHours(0, 0, 0, 0)) : undefined
		const endDate &#x3D; query.endDate ? new Date(new Date(query.endDate).setHours(23, 59, 59, 999)) : undefined

		let paginationOptions &#x3D; {}
		if (query.pagination) {
			paginationOptions &#x3D; { take: query.pageSize, skip: (query.pageNumber - 1) * query.pageSize }
		}

		const clientPayments &#x3D; await this.prisma.paymentModel.findMany({
			where: {
				staffId: query.staffId,
				type: { in: [ServiceTypeEnum.client, ServiceTypeEnum.selling] },
				OR: [{ user: { fullname: { contains: query.search, mode: &#x27;insensitive&#x27; } } }, { user: { phone: { contains: query.search, mode: &#x27;insensitive&#x27; } } }],
				createdAt: {
					...(startDate &amp;&amp; { gte: startDate }),
					...(endDate &amp;&amp; { lte: endDate }),
				},
				NOT: { AND: [{ card: 0 }, { cash: 0 }, { transfer: 0 }, { other: 0 }] },
			},
			select: {
				user: { select: { fullname: true } },
				description: true,
				cash: true,
				card: true,
				transfer: true,
				other: true,
				staff: { select: { phone: true } },
				createdAt: true,
			},
			...paginationOptions,
			orderBy: { createdAt: &#x27;desc&#x27; },
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Клиент оплаты&#x27;)

		// Ustunlar
		worksheet.columns &#x3D; [
			{ header: &#x27;№&#x27;, key: &#x27;no&#x27;, width: 5 },
			{ header: &#x27;Клиент&#x27;, key: &#x27;client&#x27;, width: 30 },
			{ header: &#x27;Информация&#x27;, key: &#x27;info&#x27;, width: 35 },
			{ header: &#x27;Оплата наличными&#x27;, key: &#x27;cash&#x27;, width: 30 },
			{ header: &#x27;Оплата банковской&#x27;, key: &#x27;card&#x27;, width: 30 },
			{ header: &#x27;Оплата перечислением&#x27;, key: &#x27;transfer&#x27;, width: 30 },
			{ header: &#x27;Оплата другими способами&#x27;, key: &#x27;other&#x27;, width: 38 },
			{ header: &#x27;Пользователь&#x27;, key: &#x27;staff&#x27;, width: 30 },
			{ header: &#x27;Дата&#x27;, key: &#x27;date&#x27;, width: 30 },
		]

		// Header row styling
		const headerRow &#x3D; worksheet.getRow(1)
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		// Data rows
		clientPayments.forEach((payment, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow({
				no: index + 1,
				client: payment.user.fullname,
				info: payment.description || &#x27;&#x27;,
				cash: payment.cash.toNumber() || 0,
				card: payment.card.toNumber() || 0,
				transfer: payment.transfer.toNumber() || 0,
				other: payment.other.toNumber() || 0,
				staff: payment.staff.phone || &#x27;&#x27;,
				date: formatDate(payment.createdAt),
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;client-payments.xlsx&quot;&#x27;)
		await workbook.xlsx.write(res)
		res.end()

		// Helperlar
		function formatDate(date: Date): string {
			const dd &#x3D; String(date.getDate()).padStart(2, &#x27;0&#x27;)
			const mm &#x3D; String(date.getMonth() + 1).padStart(2, &#x27;0&#x27;)
			const yyyy &#x3D; date.getFullYear()
			const hh &#x3D; String(date.getHours()).padStart(2, &#x27;0&#x27;)
			const min &#x3D; String(date.getMinutes()).padStart(2, &#x27;0&#x27;)
			return &#x60;${dd}.${mm}.${yyyy} ${hh}:${min}&#x60;
		}

		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async supplierPaymentDownloadMany(res: Response, query: ClientPaymentFindManyRequest) {
		const startDate &#x3D; query.startDate ? new Date(new Date(query.startDate).setHours(0, 0, 0, 0)) : undefined
		const endDate &#x3D; query.endDate ? new Date(new Date(query.endDate).setHours(23, 59, 59, 999)) : undefined

		const clientPayments &#x3D; await this.prisma.paymentModel.findMany({
			where: {
				staffId: query.staffId,
				type: { in: [ServiceTypeEnum.supplier] },
				OR: [{ user: { fullname: { contains: query.search, mode: &#x27;insensitive&#x27; } } }, { user: { phone: { contains: query.search, mode: &#x27;insensitive&#x27; } } }],
				createdAt: {
					...(startDate &amp;&amp; { gte: startDate }),
					...(endDate &amp;&amp; { lte: endDate }),
				},
				NOT: { AND: [{ card: 0 }, { cash: 0 }, { transfer: 0 }, { other: 0 }] },
			},
			select: {
				user: { select: { fullname: true } },
				description: true,
				cash: true,
				card: true,
				transfer: true,
				other: true,
				staff: { select: { phone: true } },
				createdAt: true,
			},
			orderBy: { createdAt: &#x27;desc&#x27; },
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Поставщик оплаты&#x27;)

		worksheet.columns &#x3D; [
			{ header: &#x27;№&#x27;, key: &#x27;no&#x27;, width: 5 },
			{ header: &#x27;Поставщик&#x27;, key: &#x27;supplier&#x27;, width: 30 },
			{ header: &#x27;Сумма&#x27;, key: &#x27;sum&#x27;, width: 25 },
			{ header: &#x27;Кем оприходан&#x27;, key: &#x27;staff&#x27;, width: 20 },
			{ header: &#x27;Информация&#x27;, key: &#x27;info&#x27;, width: 30 },
			{ header: &#x27;Дата&#x27;, key: &#x27;date&#x27;, width: 20 },
		]

		const headerRow &#x3D; worksheet.getRow(1)
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		clientPayments.forEach((payment, index) &#x3D;&gt; {
			const totalSum &#x3D; payment.cash.plus(payment.card).plus(payment.transfer).plus(payment.other)

			const row &#x3D; worksheet.addRow({
				no: index + 1,
				supplier: payment.user.fullname,
				sum: totalSum.toFixed(2),
				staff: payment.staff.phone || &#x27;&#x27;,
				info: payment.description || &#x27;&#x27;,
				date: formatDate(payment.createdAt),
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;supplier-payments.xlsx&quot;&#x27;)
		await workbook.xlsx.write(res)
		res.end()

		function formatDate(date: Date): string {
			const dd &#x3D; String(date.getDate()).padStart(2, &#x27;0&#x27;)
			const mm &#x3D; String(date.getMonth() + 1).padStart(2, &#x27;0&#x27;)
			const yyyy &#x3D; date.getFullYear()
			const hh &#x3D; String(date.getHours()).padStart(2, &#x27;0&#x27;)
			const min &#x3D; String(date.getMinutes()).padStart(2, &#x27;0&#x27;)
			return &#x60;${dd}.${mm}.${yyyy} ${hh}:${min}&#x60;
		}

		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async clientDeedDownloadOne(res: Response, query: ClientFindOneRequest) {
		const deedStartDate &#x3D; query.deedStartDate ? new Date(new Date(query.deedStartDate).setHours(0, 0, 0, 0)) : undefined
		const deedEndDate &#x3D; query.deedEndDate ? new Date(new Date(query.deedEndDate).setHours(23, 59, 59, 999)) : undefined

		const client &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
				payments: {
					where: { type: ServiceTypeEnum.client, createdAt: { gte: deedStartDate, lte: deedEndDate } },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				sellings: {
					where: { status: SellingStatusEnum.accepted, date: { gte: deedStartDate, lte: deedEndDate } },
					select: {
						date: true,
						products: { select: { cost: true, count: true, price: true } },
						payment: {
							where: { createdAt: { gte: deedStartDate, lte: deedEndDate } },
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
				returnings: {
					where: { status: SellingStatusEnum.accepted, createdAt: { gte: deedStartDate, lte: deedEndDate } },
					select: {
						payment: {
							where: { createdAt: { gte: deedStartDate, lte: deedEndDate } },
							select: { fromBalance: true, createdAt: true, description: true },
						},
					},
				},
			},
		})

		if (!client) throw new BadRequestException(&#x27;client not found&#x27;)

		const deeds: ClientDeed[] &#x3D; []
		let totalDebit: Decimal &#x3D; new Decimal(0)
		let totalCredit: Decimal &#x3D; new Decimal(0)

		client.payments.forEach((curr) &#x3D;&gt; {
			const totalPayment &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;payment&#x27;, value: totalPayment, date: curr.createdAt, description: curr.description })
			totalCredit &#x3D; totalCredit.plus(totalPayment)
		})

		client.sellings.forEach((sel) &#x3D;&gt; {
			const productsSum &#x3D; sel.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
			deeds.push({ type: &#x27;debit&#x27;, action: &#x27;selling&#x27;, value: productsSum, date: sel.date, description: &#x27;&#x27; })
			totalDebit &#x3D; totalDebit.plus(productsSum)

			const totalPayment &#x3D; sel.payment.card.plus(sel.payment.cash).plus(sel.payment.other).plus(sel.payment.transfer)
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;payment&#x27;, value: totalPayment, date: sel.payment.createdAt, description: sel.payment.description })
			totalCredit &#x3D; totalCredit.plus(totalPayment)
		})

		client.returnings.forEach((returning) &#x3D;&gt; {
			deeds.push({
				type: &#x27;credit&#x27;,
				action: &#x27;returning&#x27;,
				value: returning.payment.fromBalance,
				date: returning.payment.createdAt,
				description: returning.payment.description,
			})
			totalCredit &#x3D; totalCredit.plus(returning.payment.fromBalance)
		})

		const filteredDeeds &#x3D; deeds.filter((d) &#x3D;&gt; !d.value.equals(0)).sort((a, b) &#x3D;&gt; new Date(a.date).getTime() - new Date(b.date).getTime())

		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
		const clientAllInfos &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
				payments: {
					where: { type: ServiceTypeEnum.client },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				sellings: {
					where: { status: SellingStatusEnum.accepted },
					select: {
						date: true,
						products: { select: { cost: true, count: true, price: true } },
						payment: {
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
				returnings: {
					where: { status: SellingStatusEnum.accepted },
					select: {
						payment: {
							select: { fromBalance: true, createdAt: true, description: true },
						},
					},
				},
			},
		})

		let totalDebit2: Decimal &#x3D; new Decimal(0)
		let totalCredit2: Decimal &#x3D; new Decimal(0)

		clientAllInfos.payments.forEach((curr) &#x3D;&gt; {
			const totalPayment &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})

		clientAllInfos.sellings.forEach((sel) &#x3D;&gt; {
			const productsSum &#x3D; sel.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
			totalDebit2 &#x3D; totalDebit2.plus(productsSum)

			const totalPayment &#x3D; sel.payment.card.plus(sel.payment.cash).plus(sel.payment.other).plus(sel.payment.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})

		clientAllInfos.returnings.forEach((returning) &#x3D;&gt; {
			totalCredit2 &#x3D; totalCredit2.plus(returning.payment.fromBalance)
		})
		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Клиент&#x27;)

		const row1 &#x3D; worksheet.addRow([&#x60;Клиент: ${client.fullname}&#x60;, &#x27;&#x27;, &#x27;&#x27;, &#x60;Остаток: ${totalDebit2.minus(totalCredit2).toNumber()}&#x60;, &#x27;&#x27;, &#x27;&#x27;])
		worksheet.mergeCells(&#x60;A${row1.number}:C${row1.number}&#x60;)
		worksheet.mergeCells(&#x60;D${row1.number}:F${row1.number}&#x60;)
		styleRow(row1)

		const row2 &#x3D; worksheet.addRow([
			&#x60;Акт сверки с ${this.formatDate(deedStartDate || filteredDeeds[0].date)} по ${this.formatDate(deedEndDate || filteredDeeds[filteredDeeds.length - 1].date)}&#x60;,
		])
		worksheet.mergeCells(&#x60;A${row2.number}:F${row2.number}&#x60;)
		styleRow(row2)

		worksheet.addRow([])

		const headerRow &#x3D; worksheet.addRow([&#x27;№&#x27;, &#x27;Время&#x27;, &#x27;Операция&#x27;, &#x27;Дебит&#x27;, &#x27;Кредит&#x27;, &#x27;Описание&#x27;])
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		filteredDeeds.forEach((deed, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow([
				index + 1,
				this.formatDate(deed.date),
				deed.action,
				deed.type &#x3D;&#x3D;&#x3D; &#x27;debit&#x27; ? deed.value.toFixed(2) : &#x27;&#x27;,
				deed.type &#x3D;&#x3D;&#x3D; &#x27;credit&#x27; ? deed.value.toFixed(2) : &#x27;&#x27;,
				deed.description,
			])
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		const totalRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;Итого&#x27;, totalDebit.toFixed(2), totalCredit.toFixed(2)])
		styleRow(totalRow)

		const remainder &#x3D; totalDebit.minus(totalCredit)
		const lastRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;Конечный остаток&#x27;, &#x27;&#x27;, &#x27;&#x27;, remainder.toFixed(2)])
		styleRow(lastRow)

		worksheet.columns &#x3D; [{ width: 5 }, { width: 30 }, { width: 30 }, { width: 25 }, { width: 25 }, { width: 40 }]

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;client-deeds.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()

		function styleRow(row: ExcelJS.Row) {
			row.eachCell((cell) &#x3D;&gt; {
				cell.font &#x3D; { bold: true }
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		}

		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async clientDeedWithProductDownloadOne(res: Response, query: ClientFindOneRequest) {
		const deedStartDate &#x3D; query.deedStartDate ? new Date(new Date(query.deedStartDate).setHours(0, 0, 0, 0)) : undefined
		const deedEndDate &#x3D; query.deedEndDate ? new Date(new Date(query.deedEndDate).setHours(23, 59, 59, 999)) : undefined

		const client &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				fullname: true,
				payments: {
					where: { type: ServiceTypeEnum.client, createdAt: { gte: deedStartDate, lte: deedEndDate } },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				sellings: {
					where: { status: SellingStatusEnum.accepted, date: { gte: deedStartDate, lte: deedEndDate } },
					select: {
						date: true,
						products: { select: { product: { select: { name: true } }, cost: true, count: true, price: true, createdAt: true } },
						payment: {
							where: { createdAt: { gte: deedStartDate, lte: deedEndDate } },
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
				},
				returnings: {
					where: { status: SellingStatusEnum.accepted, createdAt: { gte: deedStartDate, lte: deedEndDate } },
					select: {
						payment: {
							where: { createdAt: { gte: deedStartDate, lte: deedEndDate } },
							select: { fromBalance: true, createdAt: true, description: true },
						},
					},
				},
			},
		})

		if (!client) throw new BadRequestException(&#x27;client not found&#x27;)

		const deeds: (ClientDeed &amp; { quantity: number; price: Decimal; cost: Decimal; name?: string })[] &#x3D; []
		let totalDebit &#x3D; new Decimal(0)
		let totalCredit &#x3D; new Decimal(0)

		client.payments.forEach((curr) &#x3D;&gt; {
			const total &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;payment&#x27;, value: total, date: curr.createdAt, description: curr.description, cost: total, price: total, quantity: 1 })
			totalCredit &#x3D; totalCredit.plus(total)
		})

		client.sellings.forEach((sel) &#x3D;&gt; {
			sel.products.forEach((p) &#x3D;&gt; {
				const price &#x3D; p.price.mul(p.count)
				deeds.push({
					type: &#x27;debit&#x27;,
					action: &#x27;selling&#x27;,
					value: price,
					date: p.createdAt,
					description: &#x27;&#x27;,
					cost: p.cost.mul(p.count),
					price,
					quantity: p.count,
					name: p.product.name,
				})
				totalDebit &#x3D; totalDebit.plus(price)
			})

			const pay &#x3D; sel.payment.card.plus(sel.payment.cash).plus(sel.payment.other).plus(sel.payment.transfer)
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;payment&#x27;, value: pay, date: sel.payment.createdAt, description: sel.payment.description, cost: pay, price: pay, quantity: 1 })
			totalCredit &#x3D; totalCredit.plus(pay)
		})

		client.returnings.forEach((r) &#x3D;&gt; {
			const bal &#x3D; r.payment.fromBalance
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;returning&#x27;, value: bal, date: r.payment.createdAt, description: r.payment.description, cost: bal, price: bal, quantity: 1 })
			totalCredit &#x3D; totalCredit.plus(bal)
		})

		const filtered &#x3D; deeds.filter((d) &#x3D;&gt; !d.value.equals(0)).sort((a, b) &#x3D;&gt; a.date.getTime() - b.date.getTime())
		const rows &#x3D; filtered.map((deed, i) &#x3D;&gt; [i + 1, deed.name || &#x27;&#x27;, deed.quantity, deed.price.toFixed(2), deed.cost.toFixed(2), deed.action, this.formatDate(deed.date)])

		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
		const clientAllInfos &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
				payments: {
					where: { type: ServiceTypeEnum.client },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				sellings: {
					where: { status: SellingStatusEnum.accepted },
					select: {
						date: true,
						products: { select: { cost: true, count: true, price: true } },
						payment: {
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
				returnings: {
					where: { status: SellingStatusEnum.accepted },
					select: {
						payment: {
							select: { fromBalance: true, createdAt: true, description: true },
						},
					},
				},
			},
		})

		let totalDebit2: Decimal &#x3D; new Decimal(0)
		let totalCredit2: Decimal &#x3D; new Decimal(0)

		clientAllInfos.payments.forEach((curr) &#x3D;&gt; {
			const totalPayment &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})

		clientAllInfos.sellings.forEach((sel) &#x3D;&gt; {
			const productsSum &#x3D; sel.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
			totalDebit2 &#x3D; totalDebit2.plus(productsSum)

			const totalPayment &#x3D; sel.payment.card.plus(sel.payment.cash).plus(sel.payment.other).plus(sel.payment.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})

		clientAllInfos.returnings.forEach((returning) &#x3D;&gt; {
			totalCredit2 &#x3D; totalCredit2.plus(returning.payment.fromBalance)
		})
		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

		const wb &#x3D; new ExcelJS.Workbook()
		const ws &#x3D; wb.addWorksheet(&#x27;Клиент&#x27;)

		const row1 &#x3D; ws.addRow([&#x60;Клиент: ${client.fullname}&#x60;, &#x27;&#x27;, &#x27;&#x27;, &#x60;Остаток: ${totalDebit2.minus(totalCredit2).toFixed(2)}&#x60;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;])
		ws.mergeCells(&#x60;A${row1.number}:C${row1.number}&#x60;)
		ws.mergeCells(&#x60;D${row1.number}:G${row1.number}&#x60;)
		styleRow(row1)

		const row2 &#x3D; ws.addRow([&#x60;Акт сверки с ${this.formatDate(deedStartDate || filtered[0]?.date)} по ${this.formatDate(deedEndDate || filtered[filtered.length - 1]?.date)}&#x60;])
		ws.mergeCells(&#x60;A${row2.number}:G${row2.number}&#x60;)
		styleRow(row2)

		ws.addRow([])

		const header &#x3D; ws.addRow([&#x27;№&#x27;, &#x27;Товар&#x27;, &#x27;Количество&#x27;, &#x27;Цена&#x27;, &#x27;Стоимость&#x27;, &#x27;Операция&#x27;, &#x27;Время&#x27;])
		header.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		rows.forEach((data) &#x3D;&gt; {
			const row &#x3D; ws.addRow(data)
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		const totalRow &#x3D; ws.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;Итого&#x27;, &#x27;&#x27;])
		ws.mergeCells(&#x60;A${totalRow.number}:G${totalRow.number}&#x60;)
		styleRow(totalRow)

		const debitRow &#x3D; ws.addRow([&#x27;&#x27;, &#x27;Продажи&#x27;, &#x27;&#x27;, &#x27;&#x27;, totalDebit.toFixed(2), &#x27;&#x27;, &#x27;&#x27;])
		styleRow(debitRow)

		const creditRow &#x3D; ws.addRow([&#x27;&#x27;, &#x27;Оплата&#x27;, &#x27;&#x27;, &#x27;&#x27;, totalCredit.toFixed(2), &#x27;&#x27;, &#x27;&#x27;])
		styleRow(creditRow)

		ws.columns &#x3D; [{ width: 5 }, { width: 30 }, { width: 15 }, { width: 15 }, { width: 20 }, { width: 20 }, { width: 30 }]

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;client-deeds-with-product.xlsx&quot;&#x27;)

		await wb.xlsx.write(res)
		res.end()

		function styleRow(row: ExcelJS.Row) {
			row.eachCell((cell) &#x3D;&gt; {
				cell.font &#x3D; { bold: true }
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		}

		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async supplierDeedDownloadOne(res: Response, query: ClientFindOneRequest) {
		const deedStartDate &#x3D; query.deedStartDate ? new Date(new Date(query.deedStartDate).setHours(0, 0, 0, 0)) : undefined
		const deedEndDate &#x3D; query.deedEndDate ? new Date(new Date(query.deedEndDate).setHours(23, 59, 59, 999)) : undefined

		const supplier &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
				payments: {
					where: { type: ServiceTypeEnum.supplier, createdAt: { gte: deedStartDate, lte: deedEndDate } },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				arrivals: {
					where: { date: { gte: deedStartDate, lte: deedEndDate } },
					select: {
						date: true,
						products: { select: { cost: true, count: true, price: true } },
						payment: {
							where: { createdAt: { gte: deedStartDate, lte: deedEndDate } },
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
			},
		})

		if (!supplier) throw new BadRequestException(&#x27;supplier not found&#x27;)

		const deeds: ClientDeed[] &#x3D; []
		let totalDebit &#x3D; new Decimal(0)
		let totalCredit &#x3D; new Decimal(0)

		supplier.payments.forEach((curr) &#x3D;&gt; {
			const totalPayment &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;payment&#x27;, value: totalPayment, date: curr.createdAt, description: curr.description })
			totalCredit &#x3D; totalCredit.plus(totalPayment)
		})

		supplier.arrivals.forEach((arr) &#x3D;&gt; {
			const productsSum &#x3D; arr.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
			deeds.push({ type: &#x27;debit&#x27;, action: &#x27;arrival&#x27;, value: productsSum, date: arr.date, description: &#x27;&#x27; })
			totalDebit &#x3D; totalDebit.plus(productsSum)

			const totalPayment &#x3D; arr.payment.card.plus(arr.payment.cash).plus(arr.payment.other).plus(arr.payment.transfer)
			deeds.push({ type: &#x27;credit&#x27;, action: &#x27;payment&#x27;, value: totalPayment, date: arr.payment.createdAt, description: arr.payment.description })
			totalCredit &#x3D; totalCredit.plus(totalPayment)
		})

		const filteredDeeds &#x3D; deeds.filter((d) &#x3D;&gt; !d.value.equals(0)).sort((a, b) &#x3D;&gt; new Date(a.date).getTime() - new Date(b.date).getTime())

		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
		const supplierDeedInfos &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
				payments: {
					where: { type: ServiceTypeEnum.supplier },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				arrivals: {
					select: {
						date: true,
						products: { select: { cost: true, count: true, price: true } },
						payment: {
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
			},
		})

		let totalDebit2: Decimal &#x3D; new Decimal(0)
		let totalCredit2: Decimal &#x3D; new Decimal(0)
		supplierDeedInfos.payments.forEach((curr) &#x3D;&gt; {
			const totalPayment &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})

		supplierDeedInfos.arrivals.forEach((arr) &#x3D;&gt; {
			const productsSum &#x3D; arr.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
			totalDebit2 &#x3D; totalDebit2.plus(productsSum)

			const totalPayment &#x3D; arr.payment.card.plus(arr.payment.cash).plus(arr.payment.other).plus(arr.payment.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})
		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Поставшик&#x27;)

		const row1 &#x3D; worksheet.addRow([&#x60;Поставшик: ${supplier.fullname}&#x60;, &#x27;&#x27;, &#x27;&#x27;, &#x60;Остаток: ${totalDebit2.minus(totalCredit2).toFixed(2)}&#x60;, &#x27;&#x27;, &#x27;&#x27;])
		worksheet.mergeCells(&#x60;A${row1.number}:C${row1.number}&#x60;)
		worksheet.mergeCells(&#x60;D${row1.number}:F${row1.number}&#x60;)
		styleRow(row1)

		const row2 &#x3D; worksheet.addRow([
			&#x60;Акт сверки с ${this.formatDate(deedStartDate || filteredDeeds[0].date)} по ${this.formatDate(deedEndDate || filteredDeeds[filteredDeeds.length - 1].date)}&#x60;,
		])
		worksheet.mergeCells(&#x60;A${row2.number}:F${row2.number}&#x60;)
		styleRow(row2)

		worksheet.addRow([])

		const headerRow &#x3D; worksheet.addRow([&#x27;№&#x27;, &#x27;Время&#x27;, &#x27;Операция&#x27;, &#x27;Дебит&#x27;, &#x27;Кредит&#x27;, &#x27;Описание&#x27;])
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; borderAll()
		})

		filteredDeeds.forEach((deed, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow([
				index + 1,
				this.formatDate(deed.date),
				deed.action,
				deed.type &#x3D;&#x3D;&#x3D; &#x27;debit&#x27; ? deed.value.toFixed(2) : &#x27;&#x27;,
				deed.type &#x3D;&#x3D;&#x3D; &#x27;credit&#x27; ? deed.value.toFixed(2) : &#x27;&#x27;,
				deed.description,
			])
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		})

		const totalRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;Итого&#x27;, totalDebit.toFixed(2), totalCredit.toFixed(2), &#x27;&#x27;])
		styleRow(totalRow)

		const remainderRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;&#x27;, &#x27;Конечный остаток&#x27;, &#x27;&#x27;, totalDebit.minus(totalCredit).toFixed(2), &#x27;&#x27;])
		styleRow(remainderRow)

		worksheet.columns &#x3D; [{ width: 5 }, { width: 30 }, { width: 30 }, { width: 25 }, { width: 25 }, { width: 40 }]

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;supplier-deeds.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()

		function styleRow(row: ExcelJS.Row) {
			row.eachCell((cell) &#x3D;&gt; {
				cell.font &#x3D; { bold: true }
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; borderAll()
			})
		}

		function borderAll(): Partial&lt;ExcelJS.Borders&gt; {
			return {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		}
	}

	async supplierDeedWithProductDownloadOne(res: Response, query: ClientFindOneRequest) {
		const deedStartDate &#x3D; query.deedStartDate ? new Date(new Date(query.deedStartDate).setHours(0, 0, 0, 0)) : undefined
		const deedEndDate &#x3D; query.deedEndDate ? new Date(new Date(query.deedEndDate).setHours(23, 59, 59, 999)) : undefined

		const supplier &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				payments: {
					where: {
						type: ServiceTypeEnum.supplier,
						createdAt: { gte: deedStartDate, lte: deedEndDate },
					},
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				arrivals: {
					where: { date: { gte: deedStartDate, lte: deedEndDate } },
					select: {
						date: true,
						products: {
							select: {
								product: { select: { name: true } },
								cost: true,
								count: true,
								price: true,
								createdAt: true,
							},
						},
						payment: {
							where: { createdAt: { gte: deedStartDate, lte: deedEndDate } },
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
			},
		})

		if (!supplier) throw new BadRequestException(&#x27;client not found&#x27;)

		const deeds: (ClientDeed &amp; { quantity: number; price: Decimal; cost: Decimal; name?: string })[] &#x3D; []
		let totalDebit &#x3D; new Decimal(0)
		let totalCredit &#x3D; new Decimal(0)

		supplier.payments.forEach((curr) &#x3D;&gt; {
			const total &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			deeds.push({
				type: &#x27;credit&#x27;,
				action: &#x27;payment&#x27;,
				value: total,
				date: curr.createdAt,
				description: curr.description,
				cost: total,
				price: total,
				quantity: 1,
			})
			totalCredit &#x3D; totalCredit.plus(total)
		})

		supplier.arrivals.forEach((arr) &#x3D;&gt; {
			const sum &#x3D; arr.products.reduce((acc, p) &#x3D;&gt; {
				const price &#x3D; p.price.mul(p.count)
				const cost &#x3D; p.cost.mul(p.count)

				deeds.push({
					type: &#x27;debit&#x27;,
					action: &#x27;arrival&#x27;,
					value: price,
					date: p.createdAt,
					description: &#x27;&#x27;,
					name: p.product.name,
					price,
					cost,
					quantity: p.count,
				})

				return acc.plus(price)
			}, new Decimal(0))

			totalDebit &#x3D; totalDebit.plus(sum)

			const payment &#x3D; arr.payment.card.plus(arr.payment.cash).plus(arr.payment.other).plus(arr.payment.transfer)
			if (!payment.isZero()) {
				deeds.push({
					type: &#x27;credit&#x27;,
					action: &#x27;payment&#x27;,
					value: payment,
					date: arr.payment.createdAt,
					description: arr.payment.description,
					price: payment,
					cost: payment,
					quantity: 1,
				})
				totalCredit &#x3D; totalCredit.plus(payment)
			}
		})

		const filteredDeeds &#x3D; deeds.filter((d) &#x3D;&gt; !d.value.isZero()).sort((a, b) &#x3D;&gt; new Date(a.date).getTime() - new Date(b.date).getTime())

		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
		const supplierDeedInfos &#x3D; await this.prisma.userModel.findFirst({
			where: { id: query.id },
			select: {
				id: true,
				fullname: true,
				phone: true,
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
				payments: {
					where: { type: ServiceTypeEnum.supplier },
					select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
				},
				arrivals: {
					select: {
						date: true,
						products: { select: { cost: true, count: true, price: true } },
						payment: {
							select: { card: true, cash: true, other: true, transfer: true, createdAt: true, description: true },
						},
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
			},
		})

		let totalDebit2: Decimal &#x3D; new Decimal(0)
		let totalCredit2: Decimal &#x3D; new Decimal(0)
		supplierDeedInfos.payments.forEach((curr) &#x3D;&gt; {
			const totalPayment &#x3D; curr.card.plus(curr.cash).plus(curr.other).plus(curr.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})

		supplierDeedInfos.arrivals.forEach((arr) &#x3D;&gt; {
			const productsSum &#x3D; arr.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
			totalDebit2 &#x3D; totalDebit2.plus(productsSum)

			const totalPayment &#x3D; arr.payment.card.plus(arr.payment.cash).plus(arr.payment.other).plus(arr.payment.transfer)
			totalCredit2 &#x3D; totalCredit2.plus(totalPayment)
		})
		///&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Поставшик&#x27;)

		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;name&#x27;, width: 25 },
			{ key: &#x27;quantity&#x27;, width: 15 },
			{ key: &#x27;price&#x27;, width: 15 },
			{ key: &#x27;cost&#x27;, width: 15 },
			{ key: &#x27;action&#x27;, width: 15 },
			{ key: &#x27;date&#x27;, width: 20 },
		]

		// &#x3D;&#x3D;&#x3D; 1-2 qator &#x3D;&#x3D;&#x3D;
		const row1 &#x3D; worksheet.addRow([&#x60;Клиент: ${supplier.fullname}&#x60;, &#x27;&#x27;, &#x27;&#x27;, &#x60;Остаток: ${totalDebit2.minus(totalCredit2).toFixed(2)}&#x60;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;])
		worksheet.mergeCells(&#x27;A1:C1&#x27;)
		worksheet.mergeCells(&#x27;D1:G1&#x27;)

		const fromDate &#x3D; this.formatDate(deedStartDate || filteredDeeds[0]?.date)
		const toDate &#x3D; this.formatDate(deedEndDate || filteredDeeds[filteredDeeds.length - 1]?.date)

		const row2 &#x3D; worksheet.addRow([&#x60;Акт сверки с ${fromDate} по ${toDate}&#x60;])
		worksheet.mergeCells(&#x27;A2:G2&#x27;)
		;[row1, row2].forEach((row) &#x3D;&gt;
			row.eachCell((cell) &#x3D;&gt; {
				cell.font &#x3D; { bold: true }
				cell.alignment &#x3D; { horizontal: &#x27;center&#x27;, vertical: &#x27;middle&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27; },
					left: { style: &#x27;thin&#x27; },
					bottom: { style: &#x27;thin&#x27; },
					right: { style: &#x27;thin&#x27; },
				}
			}),
		)

		worksheet.addRow([])

		// &#x3D;&#x3D;&#x3D; Header row &#x3D;&#x3D;&#x3D;
		const headerRow &#x3D; worksheet.addRow([&#x27;№&#x27;, &#x27;Товар&#x27;, &#x27;Количество&#x27;, &#x27;Цена&#x27;, &#x27;Стоимость&#x27;, &#x27;Операция&#x27;, &#x27;Время&#x27;])
		headerRow.font &#x3D; { bold: true }
		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; {
				top: { style: &#x27;thin&#x27; },
				left: { style: &#x27;thin&#x27; },
				bottom: { style: &#x27;thin&#x27; },
				right: { style: &#x27;thin&#x27; },
			}
		})

		// &#x3D;&#x3D;&#x3D; Data rows &#x3D;&#x3D;&#x3D;
		filteredDeeds.forEach((deed, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow([index + 1, deed.name || &#x27;&#x27;, deed.quantity, deed.price.toNumber(), deed.cost.toNumber(), deed.action, this.formatDate(deed.date)])
			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27; },
					left: { style: &#x27;thin&#x27; },
					bottom: { style: &#x27;thin&#x27; },
					right: { style: &#x27;thin&#x27; },
				}
			})
		})

		// &#x3D;&#x3D;&#x3D; Totals &#x3D;&#x3D;&#x3D;
		const totalDebitRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;Итого приходов:&#x27;, &#x27;&#x27;, &#x27;&#x27;, totalDebit.toNumber(), &#x27;&#x27;, &#x27;&#x27;])
		const totalCreditRow &#x3D; worksheet.addRow([&#x27;&#x27;, &#x27;Итого выплат:&#x27;, &#x27;&#x27;, &#x27;&#x27;, totalCredit.toNumber(), &#x27;&#x27;, &#x27;&#x27;])

		;[totalDebitRow, totalCreditRow].forEach((row) &#x3D;&gt;
			row.eachCell((cell) &#x3D;&gt; {
				cell.font &#x3D; { bold: true }
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27; },
					left: { style: &#x27;thin&#x27; },
					bottom: { style: &#x27;thin&#x27; },
					right: { style: &#x27;thin&#x27; },
				}
			}),
		)

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;supplier-deeds-with-product.xlsx&quot;&#x27;)
		await workbook.xlsx.write(res)
		res.end()
	}

	async clientDownloadMany(res: Response, query: ClientFindManyRequest) {
		const clients &#x3D; await this.prisma.userModel.findMany({
			where: {
				fullname: query.fullname,
				type: UserTypeEnum.client,
				OR: [{ fullname: { contains: query.search, mode: &#x27;insensitive&#x27; } }, { phone: { contains: query.search, mode: &#x27;insensitive&#x27; } }],
			},
			select: {
				fullname: true,
				phone: true,
				payments: {
					where: { type: ServiceTypeEnum.client, deletedAt: null },
					select: { card: true, cash: true, other: true, transfer: true },
				},
				sellings: {
					where: { status: SellingStatusEnum.accepted },
					select: {
						date: true,
						payment: { select: { card: true, cash: true, other: true, transfer: true } },
						products: { select: { count: true, price: true } },
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
			},
		})

		const mappedClients &#x3D; clients.map((c) &#x3D;&gt; {
			const payment &#x3D; c.payments.reduce((acc, curr) &#x3D;&gt; acc.plus(curr.card).plus(curr.cash).plus(curr.other).plus(curr.transfer), new Decimal(0))

			const sellingPayment &#x3D; c.sellings.reduce((acc, sel) &#x3D;&gt; {
				const productsSum &#x3D; sel.products.reduce((a, p) &#x3D;&gt; a.plus(p.price.mul(p.count)), new Decimal(0))
				const totalPayment &#x3D; sel.payment.card.plus(sel.payment.cash).plus(sel.payment.other).plus(sel.payment.transfer)
				return acc.plus(productsSum).minus(totalPayment)
			}, new Decimal(0))

			return {
				fullname: c.fullname,
				phone: c.phone,
				debt: sellingPayment.minus(payment),
				lastSellingDate: c.sellings?.[0]?.date ?? null,
			}
		})

		const filteredClients &#x3D; mappedClients.filter((s) &#x3D;&gt; {
			if (query.debtType &amp;&amp; query.debtValue !&#x3D;&#x3D; undefined) {
				const value &#x3D; new Decimal(query.debtValue)
				switch (query.debtType) {
					case DebtTypeEnum.gt:
						return s.debt.gt(value)
					case DebtTypeEnum.lt:
						return s.debt.lt(value)
					case DebtTypeEnum.eq:
						return s.debt.eq(value)
				}
			}
			return true
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Клиенты с долгом&#x27;)

		worksheet.columns &#x3D; [
			{ header: &#x27;№&#x27;, key: &#x27;no&#x27;, width: 5 },
			{ header: &#x27;клиент&#x27;, key: &#x27;fullname&#x27;, width: 40 },
			{ header: &#x27;телефон&#x27;, key: &#x27;phone&#x27;, width: 20 },
			{ header: &#x27;долг&#x27;, key: &#x27;debt&#x27;, width: 20 },
			{ header: &#x27;последняя дата продажи&#x27;, key: &#x27;lastSellingDate&#x27;, width: 50 },
		]

		worksheet.getRow(1).eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.fill &#x3D; {
				type: &#x27;pattern&#x27;,
				pattern: &#x27;solid&#x27;,
				fgColor: { argb: &#x27;FFB6D7A8&#x27; },
			}
			cell.border &#x3D; this.allBorder()
		})

		filteredClients.forEach((client, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow({
				no: index + 1,
				fullname: client.fullname,
				phone: client.phone,
				debt: client.debt.toFixed(2),
				lastSellingDate: client.lastSellingDate
					? new Date(client.lastSellingDate).toLocaleString(&#x27;ru-RU&#x27;, {
							year: &#x27;numeric&#x27;,
							month: &#x27;2-digit&#x27;,
							day: &#x27;2-digit&#x27;,
							hour: &#x27;2-digit&#x27;,
							minute: &#x27;2-digit&#x27;,
						})
					: &#x27;&#x27;,
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; this.allBorder()
			})
		})

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;client-debt-report.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()
	}

	async supplierDownloadMany(res: Response, query: ClientFindManyRequest) {
		const suppliers &#x3D; await this.prisma.userModel.findMany({
			where: {
				type: UserTypeEnum.supplier,
				OR: [{ fullname: { contains: query.search, mode: &#x27;insensitive&#x27; } }, { phone: { contains: query.search, mode: &#x27;insensitive&#x27; } }],
			},
			select: {
				id: true,
				fullname: true,
				phone: true,
				arrivals: {
					select: {
						date: true,
						payment: { select: { card: true, cash: true, other: true, transfer: true } },
						products: { select: { cost: true, count: true, price: true } },
					},
					orderBy: { date: &#x27;desc&#x27; },
				},
				payments: {
					where: { type: ServiceTypeEnum.supplier },
					select: { card: true, cash: true, other: true, transfer: true },
				},
				actions: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
			},
		})

		const mappedSuppliers &#x3D; suppliers.map((s) &#x3D;&gt; {
			const payment &#x3D; s.payments.reduce((acc, curr) &#x3D;&gt; acc.plus(curr.card).plus(curr.cash).plus(curr.other).plus(curr.transfer), new Decimal(0))

			const arrivalPayment &#x3D; s.arrivals.reduce((acc, arr) &#x3D;&gt; {
				const productsSum &#x3D; arr.products.reduce((a, p) &#x3D;&gt; {
					return a.plus(p.cost.mul(p.count))
				}, new Decimal(0))

				const totalPayment &#x3D; arr.payment.card.plus(arr.payment.cash).plus(arr.payment.other).plus(arr.payment.transfer)

				return acc.plus(productsSum).minus(totalPayment)
			}, new Decimal(0))
			return {
				...s,
				debt: payment.plus(arrivalPayment),
				lastArrivalDate: s.arrivals?.length ? s.arrivals[0].date : null,
			}
		})

		const filteredSuppliers &#x3D; mappedSuppliers.filter((s) &#x3D;&gt; {
			if (query.debtType &amp;&amp; query.debtValue !&#x3D;&#x3D; undefined) {
				const value &#x3D; new Decimal(query.debtValue)
				switch (query.debtType) {
					case DebtTypeEnum.gt:
						return s.debt.gt(value)
					case DebtTypeEnum.lt:
						return s.debt.lt(value)
					case DebtTypeEnum.eq:
						return s.debt.eq(value)
					default:
						return true
				}
			}
			return true
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Клиенты с долгом&#x27;)

		worksheet.columns &#x3D; [
			{ header: &#x27;№&#x27;, key: &#x27;no&#x27;, width: 5 },
			{ header: &#x27;клиент&#x27;, key: &#x27;fullname&#x27;, width: 40 },
			{ header: &#x27;телефон&#x27;, key: &#x27;phone&#x27;, width: 20 },
			{ header: &#x27;долг&#x27;, key: &#x27;debt&#x27;, width: 20 },
			{ header: &#x27;Время&#x27;, key: &#x27;lastSellingDate&#x27;, width: 30 },
		]

		worksheet.getRow(1).eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.fill &#x3D; {
				type: &#x27;pattern&#x27;,
				pattern: &#x27;solid&#x27;,
				fgColor: { argb: &#x27;FFB6D7A8&#x27; },
			}
			cell.border &#x3D; this.allBorder()
		})

		filteredSuppliers.forEach((client, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow({
				no: index + 1,
				fullname: client.fullname,
				phone: client.phone,
				debt: client.debt.toFixed(2),
				lastSellingDate: client.lastArrivalDate
					? new Date(client.lastArrivalDate).toLocaleString(&#x27;ru-RU&#x27;, {
							year: &#x27;numeric&#x27;,
							month: &#x27;2-digit&#x27;,
							day: &#x27;2-digit&#x27;,
							hour: &#x27;2-digit&#x27;,
							minute: &#x27;2-digit&#x27;,
						})
					: &#x27;&#x27;,
			})

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; this.allBorder()
			})
		})

		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;supplier-debt-report.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()
	}

	async staffPaymentDownloadMany(res: Response, query: StaffPaymentFindManyRequest) {
		const staffPayments &#x3D; await this.prisma.paymentModel.findMany({
			where: {
				staffId: query.staffId,
				type: ServiceTypeEnum.staff,
				createdAt: {
					gte: query.startDate ? new Date(new Date(query.startDate).setHours(0, 0, 0, 0)) : undefined,
					lte: query.endDate ? new Date(new Date(query.endDate).setHours(23, 59, 59, 999)) : undefined,
				},
			},
			select: {
				id: true,
				user: { select: { id: true, fullname: true, phone: true } },
				staff: { select: { id: true, fullname: true, phone: true } },
				sum: true,
				description: true,
				updatedAt: true,
				createdAt: true,
				deletedAt: true,
			},
		})

		const workbook &#x3D; new ExcelJS.Workbook()
		const worksheet &#x3D; workbook.addWorksheet(&#x27;Оплаты сотрудника&#x27;)

		// Ustun eni
		worksheet.columns &#x3D; [
			{ key: &#x27;no&#x27;, width: 5 },
			{ key: &#x27;fullname&#x27;, width: 30 },
			{ key: &#x27;phone&#x27;, width: 20 },
			{ key: &#x27;amount&#x27;, width: 20 },
			{ key: &#x27;description&#x27;, width: 30 },
			{ key: &#x27;createdAt&#x27;, width: 25 },
		]

		// Header rus tilida
		const headerRow &#x3D; worksheet.addRow([&#x27;№&#x27;, &#x27;ФИО&#x27;, &#x27;Телефон&#x27;, &#x27;Сумма оплаты&#x27;, &#x27;Примечание&#x27;, &#x27;Дата оплаты&#x27;])

		headerRow.eachCell((cell) &#x3D;&gt; {
			cell.font &#x3D; { bold: true }
			cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
			cell.border &#x3D; {
				top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			}
		})

		// Ma&#x27;lumotlar
		staffPayments.forEach((item, index) &#x3D;&gt; {
			const row &#x3D; worksheet.addRow([index + 1, item.user.fullname, item.user.phone, item.sum.toNumber(), item.description || &#x27;&#x27;, item.createdAt.toLocaleString(&#x27;ru-RU&#x27;)])

			row.eachCell((cell) &#x3D;&gt; {
				cell.alignment &#x3D; { vertical: &#x27;middle&#x27;, horizontal: &#x27;center&#x27; }
				cell.border &#x3D; {
					top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
					right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
				}
			})
		})

		// Javobga yozish
		res.setHeader(&#x27;Content-Type&#x27;, &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;)
		res.setHeader(&#x27;Content-Disposition&#x27;, &#x27;attachment; filename&#x3D;&quot;staff-payments.xlsx&quot;&#x27;)

		await workbook.xlsx.write(res)
		res.end()
	}

	private formatDate(date: Date): string {
		const dd &#x3D; String(date.getDate()).padStart(2, &#x27;0&#x27;)
		const mm &#x3D; String(date.getMonth() + 1).padStart(2, &#x27;0&#x27;) // 0-based
		const yyyy &#x3D; date.getFullYear()

		const hh &#x3D; String(date.getHours()).padStart(2, &#x27;0&#x27;)
		const min &#x3D; String(date.getMinutes()).padStart(2, &#x27;0&#x27;)

		return &#x60;${dd}.${mm}.${yyyy} ${hh}:${min}&#x60;
	}

	allBorder(): Partial&lt;ExcelJS.Borders&gt; {
		return {
			top: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			left: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			bottom: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
			right: { style: &#x27;thin&#x27;, color: { argb: &#x27;FF000000&#x27; } },
		}
	}
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ExcelService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
